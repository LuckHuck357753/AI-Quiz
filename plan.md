# ПЛАН РАЗВЕРТЫВАНИЯ ИГРЫ НА RAILWAY

Дата создания: 27.07.2025
Цель: Сделать игру доступной для игры с разных компьютеров через интернет

## ТРЕБОВАНИЯ

### Сетевая архитектура:
- Сервер развернут на Railway (круглосуточная доступность)
- Не зависит от локального ПК

### Доступность:
- Друзья подключаются по домену Railway (something.up.railway.app)
- Только браузер + ссылка

### Безопасность:
- Пароль для доступа
- Защита от атак
- Логирование активности

### Масштаб:
- До 8 игроков одновременно
- До 8 комнат одновременно

### Стабильность:
- Игра работает 24/7
- Автоматический деплой

---

## ДЕТАЛЬНЫЙ ПЛАН РЕАЛИЗАЦИИ

### Этап 1: Подготовка проекта к деплою

#### 1.1 Создание Docker-контейнера
- Создать Dockerfile для backend
- Создать docker-compose.yml для полного стека
- Настроить многоэтапную сборку (frontend + backend)

#### 1.2 Конфигурация для продакшена
- Создать railway.json для Railway
- Настроить переменные окружения
- Оптимизировать статические файлы

#### 1.3 Система аутентификации
- Добавить простую форму входа с паролем
- Middleware для проверки авторизации
- Сессии для сохранения состояния входа

### Этап 2: Модификация кода

#### 2.1 Backend изменения:
- Middleware для проверки пароля
- Логирование подключений
- Ограничение на 8 игроков и 8 комнат
- CORS настройки для домена Railway
- Обработка статических файлов frontend

#### 2.2 Frontend изменения:
- Форма входа с паролем
- Автоматическое подключение к Railway домену
- Обработка ошибок сети
- Индикатор статуса сервера

#### 2.3 Безопасность:
- Валидация входных данных
- Rate limiting для API
- Защита от DDoS
- Логирование подозрительной активности

### Этап 3: Развертывание на Railway

#### 3.1 Настройка Railway проекта:
- Создать аккаунт на Railway.app
- Создать новый проект
- Подключить GitHub репозиторий
- Настроить переменные окружения

#### 3.2 Переменные окружения:
OPENAI_API_KEY=sk-proj-...
TMDB_API_KEY=bb5f86cd8137409506cff869febf15af
VITE_GIPHY_API_KEY=0KVMqFl1tlY9mfBlLrZffFEIkwELj1Wz
ACCESS_PASSWORD=ваш_секретный_пароль
NODE_ENV=production
PORT=3000

#### 3.3 Деплой:
- Автоматический деплой при push в main
- Мониторинг логов
- Проверка работоспособности

### Этап 4: Тестирование и оптимизация

#### 4.1 Функциональное тестирование:
- Одиночная игра
- Мультиплеер (до 8 игроков)
- Все темы (Кино, Яндекс, Своя тема, Игра по файлу)
- Загрузка файлов
- Система аутентификации

#### 4.2 Нагрузочное тестирование:
- 8 одновременных игроков
- 8 активных комнат
- Обработка больших файлов
- Стабильность Socket.IO соединений

#### 4.3 Оптимизация:
- Сжатие статических файлов
- Кэширование
- Оптимизация базы данных (если понадобится)
- Мониторинг производительности

### Этап 5: Документация и инструкции

#### 5.1 Для игроков:
- Инструкция по доступу к игре
- Как ввести пароль
- Как создать/присоединиться к комнате
- FAQ по проблемам

#### 5.2 Для администратора:
- Мониторинг Railway
- Обновление пароля
- Просмотр логов
- Резервное копирование

---

## ПРЕИМУЩЕСТВА ПЛАНА

- Круглосуточная доступность - не зависит от локального ПК
- Простота использования - только браузер и ссылка
- Безопасность - пароль + защита от атак
- Масштабируемость - до 8 игроков и 8 комнат
- Автоматический деплой - обновления через GitHub
- Мониторинг - логи и метрики Railway

---

## ТЕХНИЧЕСКИЕ ДЕТАЛИ

### Необходимые файлы для создания:
1. Dockerfile - контейнеризация приложения
2. docker-compose.yml - оркестрация сервисов
3. railway.json - конфигурация Railway
4. .dockerignore - исключения для Docker
5. nginx.conf - конфигурация веб-сервера (опционально)

### Модификации существующих файлов:
1. apps/backend/src/index.ts - добавить аутентификацию и CORS
2. apps/frontend/src/App.tsx - добавить форму входа
3. package.json - добавить скрипты для продакшена

### Новые зависимости:
- express-session - для сессий
- bcrypt - для хеширования паролей
- helmet - для безопасности
- compression - для сжатия

---

## ПРИОРИТЕТЫ РЕАЛИЗАЦИИ

1. Высокий приоритет: Docker-конфигурация и Railway деплой
2. Средний приоритет: Система аутентификации
3. Низкий приоритет: Оптимизация и мониторинг

---

Статус: План готов к реализации
Следующий шаг: Начать с Этапа 1 - создания Docker-конфигурации 